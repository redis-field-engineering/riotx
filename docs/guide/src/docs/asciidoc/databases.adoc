[[_db]]
= Databases

{project-title} includes two commands for interaction with relational databases:

<<_db_import, `db-import`>>:: Import database tables into Redis
<<_db_export, `db-export`>>:: Export Redis data structures to a database

[[_db_drivers]]
== Drivers

{project-title} relies on JDBC to interact with databases.
It includes JDBC drivers for the most common database systems:

https://www.ibm.com/docs/en/db2/12.1?topic=cdsudidsdjs-url-format-data-server-driver-jdbc-sqlj-type-4-connectivity[Db2]:: `jdbc:db2://host:port/database`

https://dev.mysql.com/doc/connector-j/8.0/en/connector-j-reference-jdbc-url-format.html[MySQL]:: `jdbc:mysql://[host]:[port][/database][?properties]`

https://docs.oracle.com/cd/E11882_01/appdev.112/e13995/oracle/jdbc/OracleDriver.html[Oracle]:: `jdbc:oracle:thin:@myhost:1521:orcl`

https://www.postgresql.org/docs/7.4/jdbc-use.html[Postgres]:: `jdbc:postgresql://host:port/database`

https://docs.snowflake.com/en/developer-guide/jdbc/jdbc-configure[Snowflake]:: `jdbc:snowflake://<account_identifier>.snowflakecomputing.com/?<connection_params>`

https://docs.microsoft.com/en-us/sql/connect/jdbc/building-the-connection-url?view=sql-server-2017[SQL Server]:: `jdbc:sqlserver://[serverName[\instanceName][:portNumber]][;property=value[;property=value]]`


[TIP]
====
For non-included databases, place the JDBC driver jar under the `lib` directory
====

[[_db_import]]
== Database Import

The `db-import` command imports data from a relational database into Redis.

NOTE: Ensure {project-title} has the relevant JDBC driver for your database.
See the <<_db_drivers,Drivers>> section for more details.

[source,console,subs="verbatim,attributes"]
----
{app} db-import --jdbc-url <jdbc url> -u <Redis URI> SQL [REDIS COMMAND...]
----

To show the full usage, run:

[source,console,subs="verbatim,attributes"]
----
{app} db-import --help
----

You must specify at least one Redis command as a target.

IMPORTANT: Redis connection options apply to the root command (`{app}`) and not to subcommands.

The keys that will be written are constructed from input records by concatenating the keyspace prefix and key fields.

image::mapping.svg[]

.PostgreSQL Import Example
[source,console]
----
include::{testdir}/db-import-postgresql[]
----

.Import from PostgreSQL to JSON strings
[source,console]
----
include::{testdir}/db-import-postgresql-set[]
----

This will produce Redis strings that look like this:
[source,json]
----
include::{includedir}/../resources/order.json[]
----

include::{includedir}/snowflake-import.adoc[leveloffset=+1]

[[_db_export]]
== Database Export

Use the `db-export` command to read from a Redis database and writes to a SQL database.

NOTE: Ensure {project-title} has the relevant JDBC driver for your database.
See the <<_db_drivers,Drivers>> section for more details.

The general usage is:
[source,console,subs="verbatim,attributes"]
----
{app} db-export --jdbc-url <jdbc url> SQL
----

To show the full usage, run:
[source,console,subs="verbatim,attributes"]
----
{app} db-export --help
----

.Example: export to PostgreSQL
[source,console]
----
include::{testdir}/db-export-postgresql[]
----
