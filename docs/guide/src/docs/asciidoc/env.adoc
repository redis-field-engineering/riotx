[[_env]]
= Environment Variables

{project-title} supports configuration via environment variables for some command-line options.
This allows for convenient automation and containerized deployments without exposing sensitive information in command lines.

== Job

[cols="1,2,1,3"]
|===
| Variable | CLI Option | Default | Description

| `RIOT_THREADS` | `--threads` | `1` | Number of concurrent threads to use for batch processing.
| `RIOT_BATCH` | `--batch` | `50` | Number of items in each batch.
| `RIOT_RATE` | `--rate` | _none_ | Limit number of items written per second (e.g., 100 or 5k).
| `RIOT_DRY_RUN` | `--dry-run` | `false` | Enable dummy writes.
| `RIOT_SKIP` | `--skip` | _none_ | Number of failed items before failing the job.
| `RIOT_RETRY` | `--retry` | `3` | Number of times to retry failed items: 0 → never, -1 → always.
| `RIOT_FLUSH` | `--flush` | `50ms` | Max duration between batch flushes.
| `RIOT_IDLE` | `--idle` | _none_ | Min duration to consider reader complete (e.g., 3s 5m).
|===

=== Source Redis

[cols="1,2,1,3"]
|===
| Variable | CLI Option | Default | Description

| `RIOT_SOURCE` | Source URI parameter | _none_ | Source server URI.
| `RIOT_SOURCE_USER` | `--source-user` | _none_ | Source ACL style 'AUTH username pass'. Needs password.
| `RIOT_SOURCE_PASS` | `--source-pass` | _none_ | Password to use when connecting to the source server.
| `RIOT_SOURCE_TIMEOUT` | `--source-timeout` | `60s` | Source Redis command timeout (e.g., 30s or 5m).
| `RIOT_SOURCE_TLS` | `--source-tls` | `false` | Establish a secure TLS connection to source.
| `RIOT_SOURCE_INSECURE` | `--source-insecure` | `false` | Allow insecure TLS connection to source by skipping cert validation.
| `RIOT_SOURCE_CLIENT` | `--source-client` | _none_ | Client name used to connect to source Redis.
| `RIOT_SOURCE_CLUSTER` | `--source-cluster` | `false` | Enable source cluster mode.
| `RIOT_SOURCE_RESP` | `--source-resp` | `RESP2` | Redis protocol version used to connect to source.
| `RIOT_SOURCE_POOL` | `--source-pool` | `8` | Max number of source Redis connections.
| `RIOT_SOURCE_READ_FROM` | `--source-read-from` | `UPSTREAM` | Which source Redis cluster nodes to read from.
|===

=== Target Redis

[cols="1,2,1,3"]
|===
| Variable | CLI Option | Default | Description

| `RIOT_TARGET` | Target URI parameter | _none_ | Target server URI.
| `RIOT_TARGET_USER` | `--target-user` | _none_ | Target ACL style 'AUTH username pass'. Needs password.
| `RIOT_TARGET_PASS` | `--target-pass` | _none_ | Password to use when connecting to the target server.
| `RIOT_TARGET_TIMEOUT` | `--target-timeout` | `60s` | Target Redis command timeout (e.g., 30s or 5m).
| `RIOT_TARGET_TLS` | `--target-tls` | `false` | Establish a secure TLS connection to target.
| `RIOT_TARGET_INSECURE` | `--target-insecure` | `false` | Allow insecure TLS connection to target by skipping cert validation.
| `RIOT_TARGET_CLIENT` | `--target-client` | _none_ | Client name used to connect to target Redis.
| `RIOT_TARGET_CLUSTER` | `--target-cluster` | `false` | Enable target cluster mode.
| `RIOT_TARGET_RESP` | `--target-resp` | `RESP2` | Redis protocol version used to connect to target.
| `RIOT_TARGET_POOL` | `--target-pool` | `8` | Max number of target Redis connections.
| `RIOT_TARGET_READ_FROM` | `--target-read-from` | `UPSTREAM` | Which target Redis cluster nodes to read from.
|===

== Reader

[cols="1,2,1,3"]
|===
| Variable | CLI Option | Default | Description

| `RIOT_KEY_PATTERN` | `--key-pattern` | _none_ | Pattern of keys to read (default: all keys).
| `RIOT_KEY_TYPE` | `--key-type` | _none_ | Type of keys to read (default: all types).
| `RIOT_SCAN_COUNT` | `--scan-count` | `100` | How many keys to read at once on each scan iteration.
| `RIOT_READ_BATCH` | `--read-batch` | `50` | Number of values each reader thread should read in a pipelined call.
| `RIOT_EVENT_QUEUE` | `--event-queue` | `10000` | Capacity of the keyspace notification queue.
|===

== Processor

[cols="1,2,1,3"]
|===
| Variable | CLI Option | Default | Description

| `RIOT_NO_TTL` | `--no-ttl` | `false` | Do not propagate key expiration times.
| `RIOT_STREAM_ID` | `--stream-id` | `true` | Propagate stream message IDs.
| `RIOT_STREAM_PRUNE` | `--stream-prune` | `false` | Drop empty streams.
| `RIOT_MERGE` | `--merge` | `false` | Merge collection data structures instead of overwriting them.
|===

== Replication

[cols="1,2,1,3"]
|===
| Variable | CLI Option | Default | Description

| `RIOT_SYNC_MODE` | `--mode` | `SCAN` | Replication mode: SCAN, LIVE, or LIVEONLY.
| `RIOT_SYNC_STRUCT` | `--struct` | `false` | Enable data structure-specific replication.
| `RIOT_LOG_KEYS` | `--log-keys` | `false` | Log keys being read and written.
| `RIOT_COMPARE` | `--compare` | `QUICK` | Compare mode: QUICK, FULL, or NONE.
| `RIOT_REMOVE_SOURCE_KEYS` | `--remove-source-keys` | `false` | Delete keys from source after successful replication.
|===

== Observability

[cols="1,2,1,3"]
|===
| Variable | CLI Option | Default | Description

| `RIOT_LOG` | `--log-level` | `WARN` | Set log level: ERROR, WARN, INFO, DEBUG, or TRACE.
| `RIOT_PROGRESS` | `--progress` | `ASCII` | Progress style: ASCII, BAR, BLOCK, or NONE.
| `RIOT_METRICS` | `--metrics` | `false` | Enable metrics.
| `RIOT_METRICS_JVM` | `--metrics-jvm` | `true` | Enable/disable JVM metrics.
| `RIOT_METRICS_REDIS` | `--metrics-redis` | `false` | Enable command latency metrics.
| `RIOT_METRICS_PORT` | `--metrics-port` | `8080` | Port that Prometheus HTTP server should listen on.
|===

== Usage Examples

=== Basic Replication

[source,bash]
----
export RIOT_SOURCE_USER=myuser
export RIOT_SOURCE_PASS=mypassword
export RIOT_TARGET_USER=targetuser
export RIOT_TARGET_PASS=targetpassword
export RIOT_THREADS=4
export RIOT_BATCH=100

riotx replicate redis://source:6379 redis://target:6379
----

=== Import

[source,bash]
----
export RIOT_THREADS=8
export RIOT_BATCH=500
export RIOT_FLUSH=10ms
export RIOT_RATE=10000
export RIOT_METRICS=true
export RIOT_PROGRESS=BAR

riotx file-import mydata.csv redis://localhost:6379
----

=== TLS Connection

[source,bash]
----
export RIOT_SOURCE_TLS=true
export RIOT_SOURCE_INSECURE=true
export RIOT_TARGET_TLS=true
export RIOT_TARGET_INSECURE=true

riotx replicate redis://secure-source:6380 redis://secure-target:6380
----

=== Docker

[source,bash]
----
docker run --env-file riot.env riotx/riotx:latest replicate \
  redis://source:6379 redis://target:6379
----

Where `riot.env` contains:
[source]
----
RIOT_THREADS=4
RIOT_BATCH=100
RIOT_SOURCE_PASS=sourcepassword
RIOT_TARGET_PASS=targetpassword
RIOT_METRICS=true
RIOT_LOG=INFO
----

== Notes

* Environment variables take precedence over command-line defaults but are overridden by explicit command-line arguments.
* Boolean values can be set to `true` or `false`.
* Duration values support suffixes like `s` (seconds), `m` (minutes), `h` (hours).
* Numeric values with suffixes like `k` (thousand) and `m` (million) are supported where applicable.
* Sensitive values like passwords should be set via environment variables rather than command-line arguments for security.
