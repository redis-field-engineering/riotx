plugins {
    id 'org.kordamp.gradle.guide'
    id 'org.ajoberstar.git-publish'
    id 'org.asciidoctor.jvm.pdf'
}

configurations {
    asciidoctorExtensions
}

dependencies {
    asciidoctorExtensions 'com.bmuschko:asciidoctorj-tabbed-code-extension:0.3'
}

asciidoctor {
    configurations 'asciidoctorExtensions'
    outputOptions {
        backends = ['pdf', 'html5']
        separateOutputDirs = false
    }
    forkOptions {
      // Fix issue with JDK16+
      jvmArgs("--add-opens", "java.base/sun.nio.ch=ALL-UNNAMED", "--add-opens", "java.base/java.io=ALL-UNNAMED")
    }
    attributes = [
        numbered                : false,
        'source-highlighter'    : 'coderay',
        'coderay-linenums-mode' : 'table',
        'testdir'               : '../../../../../plugins/riotx/src/test/resources'
    ]
    doLast {
      file("$outputDir/index.pdf").
              renameTo("$outputDir/riotx-${project.version}.pdf")
    }
}

eclipse {
    project {
        name = 'riotx-guide'
    }
}